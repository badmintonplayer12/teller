<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Badminton Poengteller</title>
  <style>
    :root{ --gap: clamp(12px, 3vw, 36px); }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    html,body{ height:100%; }
    body{ margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; background:#0f172a; color:#fff; display:flex; flex-direction:column; max-width:100vw; overflow-x:hidden; }

    header{ background:#1f2937; padding:.5rem 1rem; display:flex; align-items:center; gap:1rem; justify-content:space-between; position:relative; }
    header h1{ font-size:1rem; margin:0 }
    #version{ position:absolute; top:.3rem; right:.6rem; font-size:.75rem; color:#9ca3af; pointer-events:none }

    /* Side-by-side layout */
    .wrap{ flex:0 0 auto; min-height:100vh; display:grid; grid-template-columns:1fr 2px 1fr; column-gap:var(--gap); padding:var(--gap); align-items:stretch; }
    .divider{ width:2px; background:#1e293b; }

    .side{ position:relative; background:#111827; border-radius:.8rem; padding:clamp(8px, 1.8vw, 16px); display:flex; flex-direction:column; align-items:center; justify-content:flex-start; overflow:hidden; will-change:transform,opacity }

    /* Horisontal sideswap */
    .side.swap-exit-left{  animation: exitLeft .35s ease both }
    .side.swap-exit-right{ animation: exitRight .35s ease both }
    .side.swap-enter-left{ animation: enterLeft .35s ease both }
    .side.swap-enter-right{animation: enterRight .35s ease both }
    @keyframes exitLeft   { from{opacity:1;transform:translateX(0)}   to{opacity:.15;transform:translateX(-14%)} }
    @keyframes exitRight  { from{opacity:1;transform:translateX(0)}   to{opacity:.15;transform:translateX(14%)} }
    @keyframes enterLeft  { from{opacity:.15;transform:translateX(14%)}  to{opacity:1; transform:translateX(0)} }
    @keyframes enterRight { from{opacity:.15;transform:translateX(-14%)} to{opacity:1; transform:translateX(0)} }

    /* Navn begrenset til typisk fornavn (‚âà15 tegn) */
    .name{ min-height: clamp(36px, 6vh, 56px); display:flex; align-items:center; justify-content:center; width:100%; margin:0 0 .25rem 0; }
    .name input{ font:inherit; color:#e5e7eb; background:#1f2937; border:1px solid #0008; border-radius:.5rem; padding:.35rem .75rem; text-align:center; width: min(15ch, 80%); max-width:15ch; overflow:hidden; text-overflow:ellipsis; }

    .setCounter{ position:absolute; top:.5rem; right:.75rem; background:#22c55e; color:#06210f; font-weight:900; border-radius:999px; padding:.2rem .6rem; min-width:2rem; text-align:center }

    .scoreBox{ flex:1 1 auto; width:100%; min-height:0; display:flex; align-items:center; justify-content:center; overflow:hidden }
    .score{ width:100%; display:flex; justify-content:center; align-items:center; text-align:center; font-weight:900; line-height:0.92; cursor:pointer; user-select:none; -webkit-user-select:none; white-space:nowrap; overflow:hidden; font-variant-numeric:tabular-nums; will-change:transform, text-shadow; padding:0 2vw }

    .digits{ display:flex; gap:0.08em; align-items:baseline; max-width:100%; overflow:hidden }
    .digit{ display:inline-block; width:1ch; text-align:center }
    .digit.ghost{ visibility:hidden }

    #sets{ padding:.4rem 1rem; text-align:center; font-size:1rem }
    #winnerMsg{ padding:.75rem 1rem 0; text-align:center; font-size:clamp(1.1rem,3.5vw,2rem); color:#facc15; font-weight:900; white-space:pre-line }

    .pop{ animation: glowBurst .55s ease-out 1; }
    @keyframes glowBurst{ 0%{text-shadow:0 0 0 rgba(96,165,250,0); transform:scale(1);} 20%{text-shadow:0 0 30px rgba(96,165,250,.95),0 0 70px rgba(59,130,246,.8),0 0 110px rgba(37,99,235,.7); transform:scale(1.08);} 60%{text-shadow:0 0 20px rgba(96,165,250,.55),0 0 50px rgba(59,130,246,.45); transform:scale(1.03);} 100%{text-shadow:0 0 0 rgba(96,165,250,0); transform:scale(1);} }

    .measuring .score{ transform:none !important; }
    .score::selection{ background:transparent }

    /* Under folden: en ekstra seksjon som starter rett etter 100vh
       Sticky-knapper blir synlige straks man scroller bittelitt. */
    .belowFold{ height: calc(100vh + 24px); display:grid; grid-template-columns:1fr 1fr; gap:var(--gap); padding: 0 var(--gap); align-items:flex-start; }
    .belowFold .minusBtn{ position: sticky; top: 10px; justify-self:center; font-size:1.3rem; padding:.55rem 1rem; border-radius:.6rem; border:0; background:#ef4444; color:#fff; cursor:pointer }
  </style>
</head>
<body>
  <header>
    <h1>üè∏ Badminton Poengteller</h1>
    <button id="fsBtn" onclick="toggleFullscreen()">‚õ∂ Fullskjerm</button>
    <div id="version">v5.3</div>
  </header>

  <div id="sets">Sett: 0-0</div>

  <div class="wrap">
    <div class="side" id="sideA">
      <div id="setCounterA" class="setCounter" style="display:none">0</div>
      <div class="name"><input id="nameA" value="Spiller A" /></div>
      <div class="scoreBox">
        <div class="score" id="scoreA" onclick="addPoint('A')">
          <span class="digits" id="A_digits">
            <span class="digit" id="A_tens">0</span>
            <span class="digit" id="A_ones">0</span>
          </span>
        </div>
      </div>
    </div>

    <div class="divider"></div>

    <div class="side" id="sideB">
      <div id="setCounterB" class="setCounter" style="display:none">0</div>
      <div class="name"><input id="nameB" value="Spiller B" /></div>
      <div class="scoreBox">
        <div class="score" id="scoreB" onclick="addPoint('B')">
          <span class="digits" id="B_digits">
            <span class="digit" id="B_tens">0</span>
            <span class="digit" id="B_ones">0</span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Minusknapper finnes i en egen seksjon rett under folden -->
  <section class="belowFold">
    <button class="minusBtn" onclick="removePoint('A')">‚àí1</button>
    <button class="minusBtn" onclick="removePoint('B')">‚àí1</button>
  </section>

  <div id="winnerMsg"></div>

  <footer style="text-align:center; padding:.5rem 1rem .9rem; display:flex; gap:.5rem; justify-content:center; flex-wrap:wrap;">
    <button onclick="swapSides()">Bytt side</button>
    <button onclick="resetSet()">Nullstill sett</button>
    <button id="newMatchBtn" onclick="startNewMatch()">Start ny kamp</button>
    <button onclick="resetMatch()">Nullstill kamp</button>
  </footer>

  <script>
    let scoreA=0, scoreB=0; let setsA=0, setsB=0; const target=21, cap=30; let currentSet=1; let swappedAt11=false; let locked=false;

    function update(){
      document.getElementById('sets').textContent = `Sett: ${setsA}-${setsB}`;
      const counterA=document.getElementById('setCounterA');
      const counterB=document.getElementById('setCounterB');
      counterA.style.display = setsA>0 ? 'flex' : 'none';
      counterB.style.display = setsB>0 ? 'flex' : 'none';
      if(setsA>0) counterA.textContent = setsA;
      if(setsB>0) counterB.textContent = setsB;

      const setDigits=(score,prefix)=>{
        const tens=Math.floor(score/10), ones=score%10;
        const t=document.getElementById(prefix+'_tens');
        const o=document.getElementById(prefix+'_ones');
        if(score<10){ t.textContent='0'; t.classList.add('ghost'); } else { t.textContent=String(tens); t.classList.remove('ghost'); }
        o.textContent=String(ones);
      };
      setDigits(scoreA,'A'); setDigits(scoreB,'B');
    }

    // M√•le-basert, robust skalering
    function fitScores(){
      document.body.classList.add('measuring');
      const base=100; // px
      const sA=document.getElementById('scoreA');
      const sB=document.getElementById('scoreB');
      sA.style.fontSize=base+'px'; sB.style.fontSize=base+'px';

      const sideA=document.getElementById('sideA');
      const sideB=document.getElementById('sideB');

      const nameAH = document.querySelector('#sideA .name').offsetHeight;
      const nameBH = document.querySelector('#sideB .name').offsetHeight;
      const sidePad = (el)=>{ const cs=getComputedStyle(el); return (parseFloat(cs.paddingTop)||0)+(parseFloat(cs.paddingBottom)||0); };

      const availHA = Math.max(40, sideA.clientHeight - nameAH - sidePad(sideA));
      const availHB = Math.max(40, sideB.clientHeight - nameBH - sidePad(sideB));

      const boxA = document.querySelector('#sideA .scoreBox');
      const boxB = document.querySelector('#sideB .scoreBox');
      const padX = (el)=>{ const cs=getComputedStyle(el); return (parseFloat(cs.paddingLeft)||0)+(parseFloat(cs.paddingRight)||0); };
      const availWA = Math.max(40, boxA.clientWidth - padX(sA));
      const availWB = Math.max(40, boxB.clientWidth - padX(sB));

      const aRect = document.getElementById('A_digits').getBoundingClientRect();
      const bRect = document.getElementById('B_digits').getBoundingClientRect();

      const scaleA = Math.min(availWA / Math.max(1,aRect.width),  availHA / Math.max(1,aRect.height));
      const scaleB = Math.min(availWB / Math.max(1,bRect.width),  availHB / Math.max(1,bRect.height));
      const scale  = Math.max(0.01, Math.min(scaleA, scaleB));

      const f = Math.floor(base * scale);
      sA.style.fontSize=f+'px'; sB.style.fontSize=f+'px';
      document.body.classList.remove('measuring');
    }

    function bump(el){ el.classList.remove('pop'); void el.offsetWidth; el.classList.add('pop'); setTimeout(()=>el.classList.remove('pop'),550); }

    function addPoint(side){ if(locked) return; if(side==='A') scoreA++; else scoreB++; checkSetEnd(); update(); bump(document.getElementById(side==='A'?'scoreA':'scoreB')); fitScores(); }
    function removePoint(side){ if(locked) return; if(side==='A'&&scoreA>0) scoreA--; if(side==='B'&&scoreB>0) scoreB--; update(); fitScores(); }

    function checkSetEnd(){
      const lead=Math.abs(scoreA-scoreB);
      if((scoreA>=target||scoreB>=target)&&(lead>=2||scoreA===cap||scoreB===cap)){
        if(scoreA>scoreB) setsA++; else setsB++;
        if(setsA===2||setsB===2){
          const nameA=document.getElementById('nameA').value; const nameB=document.getElementById('nameB').value;
          const matchWinner=setsA===2?nameA:nameB; const matchLoser=setsA===2?nameB:nameA;
          document.getElementById('winnerMsg').textContent=`üéâ GRATULERER ${matchWinner.toUpperCase()}! DU VANT KAMPEN!\nüëè BRA JOBBA ${matchLoser.toUpperCase()}, DU GJORDE DITT BESTE.`;
          locked=true; return;
        }
        scoreA=0; scoreB=0; currentSet++; swappedAt11=false; animateSwapThenSwapData();
      }
      if(currentSet===3 && !swappedAt11 && (scoreA===11||scoreB===11)){
        animateSwapThenSwapData(); swappedAt11=true;
      }
    }

    function animateSwapThenSwapData(){
      const a=document.getElementById('sideA');
      const b=document.getElementById('sideB');
      a.classList.add('swap-exit-left');
      b.classList.add('swap-exit-right');
      const onEnd=()=>{
        a.removeEventListener('animationend', onEnd);
        const nameA=document.getElementById('nameA'); const nameB=document.getElementById('nameB');
        const tmpName=nameA.value; nameA.value=nameB.value; nameB.value=tmpName;
        const tmpScore=scoreA; scoreA=scoreB; scoreB=tmpScore;
        const tmpSets=setsA; setsA=setsB; setsB=tmpSets;
        update();
        a.classList.remove('swap-exit-left'); b.classList.remove('swap-exit-right');
        a.classList.add('swap-enter-left'); b.classList.add('swap-enter-right');
        fitScores();
        setTimeout(()=>{ a.classList.remove('swap-enter-left'); b.classList.remove('swap-enter-right'); }, 380);
      };
      a.addEventListener('animationend', onEnd);
    }

    function swapSides(){ animateSwapThenSwapData(); }

    function resetSet(){ if(locked) return; scoreA=0; scoreB=0; swappedAt11=false; document.getElementById('winnerMsg').textContent=''; update(); fitScores(); }
    function resetMatch(){ scoreA=0; scoreB=0; setsA=0; setsB=0; currentSet=1; swappedAt11=false; locked=false; document.getElementById('winnerMsg').textContent=''; update(); fitScores(); }
    function startNewMatch(){ resetMatch(); }

    function toggleFullscreen(){ const btn=document.getElementById('fsBtn'); if(!document.fullscreenElement){ document.documentElement.requestFullscreen(); if(btn) btn.textContent='‚§¢ Avslutt fullskjerm'; } else { document.exitFullscreen(); if(btn) btn.textContent='‚õ∂ Fullskjerm'; } }

    const queueFit = (()=>{ let raf=0, t=0; return function(){ cancelAnimationFrame(raf); clearTimeout(t); raf=requestAnimationFrame(()=>{ fitScores(); t=setTimeout(fitScores, 60); }); } })();
    window.addEventListener('resize', queueFit);
    document.addEventListener('fullscreenchange', queueFit);
    if(window.visualViewport){ visualViewport.addEventListener('resize', queueFit); }
    window.addEventListener('orientationchange', ()=>{ setTimeout(queueFit, 60); });

    update();
    queueFit();
  </script>
</body>
</html>
