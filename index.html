<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Badminton Poengteller</title>
  <style>
    :root{ --vh: 1vh; }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{margin:0;font-family:system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";background:#0f172a;color:#fff;display:flex;flex-direction:column;height:100%;}
    header{background:#1f2937;padding:.5rem 1rem;display:flex;align-items:center;gap:1rem;justify-content:space-between}
    header h1{font-size:1rem;margin:0}
    .wrap{flex:1;display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:1rem}
    .side{background:#111827;border-radius:.8rem;padding:1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
    .name{font-size:1.2rem;margin-bottom:.5rem}
    .name input{font:inherit;color:#e5e7eb;background:#1f2937;border:1px solid #0008;border-radius:.4rem;padding:.25rem .5rem;text-align:center;width:100%}

    .score{width:100%; text-align:center; font-weight:900; line-height:0.92; cursor:pointer; user-select:none; -webkit-user-select:none; white-space:nowrap; overflow:hidden;
           font-variant-numeric: tabular-nums; will-change: text-shadow, color; touch-action:manipulation;}
    .score::selection{background:transparent}

    .minusBtn{margin-top:.75rem;font-size:1.4rem;padding:.6rem 1rem;border-radius:.6rem;border:0;background:#ef4444;color:#fff;cursor:pointer;touch-action:manipulation}

    footer{background:#1f2937;padding:.6rem 1rem;display:flex;gap:.6rem;justify-content:center;flex-wrap:wrap}
    footer button{padding:.6rem 1rem;border-radius:.6rem;border:0;cursor:pointer;touch-action:manipulation}

    #sets{padding:.6rem 1rem;text-align:center;font-size:1.2rem}
    #winnerMsg{padding:1rem 1rem 0;text-align:center;font-size:clamp(1.2rem,3.5vw,2rem);color:#facc15;font-weight:900;white-space:pre-line}

    .setCounter{position:absolute;top:.5rem;right:.5rem;background:#22c55e;color:#06210f;font-weight:900;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}

    /* Trykk-animasjon: gl√∏d + fargeendring uten layout-endring */
    @keyframes glowChange { 0%{ color:#fff; text-shadow:none; } 40%{ color:#facc15; text-shadow:0 0 25px rgba(250,204,21,.8); } 100%{ color:#fff; text-shadow:none; } }
    .score.pop { animation: glowChange 280ms ease-out; }

    .final .score, .final .minusBtn { pointer-events:none; opacity:.85 }
    #newMatchBtn{display:none;background:#22c55e;color:#06210f;font-weight:900}
    .final #newMatchBtn{display:inline-block}

    #measure{position:absolute;left:-9999px;top:-9999px;visibility:hidden;white-space:nowrap;font-weight:900;line-height:0.92;font-variant-numeric:tabular-nums}
  </style>
</head>
<body>
  <header>
    <h1>üè∏ Badminton Poengteller</h1>
    <button id="fsBtn" onclick="toggleFullscreen()">‚õ∂ Fullskjerm</button>
  </header>

  <div id="sets">Sett: 0‚Äì0</div>

  <div class="wrap">
    <div class="side" id="sideA">
      <div id="setCounterA" class="setCounter" style="display:none">0</div>
      <div class="name"><input id="nameA" value="Spiller A" /></div>
      <div class="score" id="scoreA" onclick="addPoint('A')">0</div>
      <button class="minusBtn" onclick="removePoint('A')">‚àí1</button>
    </div>

    <div class="side" id="sideB">
      <div id="setCounterB" class="setCounter" style="display:none">0</div>
      <div class="name"><input id="nameB" value="Spiller B" /></div>
      <div class="score" id="scoreB" onclick="addPoint('B')">0</div>
      <button class="minusBtn" onclick="removePoint('B')">‚àí1</button>
    </div>
  </div>

  <div id="winnerMsg"></div>

  <footer>
    <button onclick="swapSides()">Bytt side</button>
    <button onclick="resetSet()">Nullstill sett</button>
    <button id="newMatchBtn" onclick="startNewMatch()">Start ny kamp</button>
    <button onclick="resetMatch()">Nullstill kamp</button>
  </footer>

  <span id="measure">88</span>

  <script>
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01)+'px'); }
    setVH();

    let scoreA=0, scoreB=0;
    let setsA=0, setsB=0;
    const target=21, cap=30;
    let currentSet=1;
    let swappedAt11=false;
    let locked=false;          // l√•s poeng etter kamp-slutt
    let scoreFontPx=null;      // l√•s fontst√∏rrelse mellom oppdateringer

    function update(){
      document.getElementById('scoreA').textContent=scoreA;
      document.getElementById('scoreB').textContent=scoreB;
      document.getElementById('sets').textContent=`Sett: ${setsA}‚Äì${setsB}`;
      const counterA=document.getElementById('setCounterA');
      const counterB=document.getElementById('setCounterB');
      if(setsA>0){counterA.style.display='flex';counterA.textContent=setsA;}else counterA.style.display='none';
      if(setsB>0){counterB.style.display='flex';counterB.textContent=setsB;}else counterB.style.display='none';
      // Ikke kall resizeScores() her ‚Äì vi vil beholde l√•st fontst√∏rrelse mellom poeng
    }

    // Beregn fontst√∏rrelse kun ved skjerm-/modusendringer
    function resizeScores(force){
      if(!force && typeof scoreFontPx==='number'){
        document.getElementById('scoreA').style.fontSize = scoreFontPx + 'px';
        document.getElementById('scoreB').style.fontSize = scoreFontPx + 'px';
        return;
      }
      const sideA=document.getElementById('sideA');
      const sA=document.getElementById('scoreA');
      const sB=document.getElementById('scoreB');
      const meas=document.getElementById('measure');
      const vwHalf=sideA.clientWidth; // ~50% av skjermen
      const maxVhPct=document.body.classList.contains('final')?35:70; // 70% normalt, 35% i finale
      const maxH=Math.floor(window.innerHeight*(maxVhPct/100));
      const baseFont=100;
      meas.style.fontSize=baseFont+'px';
      meas.textContent='88';
      const rect=meas.getBoundingClientRect();
      const wBase=rect.width||1;
      const hBase=rect.height||1;
      const sizeByWidth=vwHalf/wBase*baseFont;
      const sizeByHeight=maxH/hBase*baseFont;
      scoreFontPx=Math.floor(Math.min(sizeByWidth,sizeByHeight));
      sA.style.fontSize=scoreFontPx+'px';
      sB.style.fontSize=scoreFontPx+'px';
    }

    function bump(el){ el.classList.remove('pop'); void el.offsetWidth; el.classList.add('pop'); }

    function addPoint(side){
      if(locked) return;
      if(side==='A') scoreA++; else scoreB++;
      checkSetEnd();
      update();
      bump(document.getElementById(side==='A' ? 'scoreA':'scoreB'));
    }
    function removePoint(side){
      if(locked) return;
      if(side==='A'&&scoreA>0) scoreA--; if(side==='B'&&scoreB>0) scoreB--;
      update();
    }

    function checkSetEnd(){
      const lead=Math.abs(scoreA-scoreB);
      if((scoreA>=target||scoreB>=target)&&(lead>=2||scoreA===cap||scoreB===cap)){
        if(scoreA>scoreB) setsA++; else setsB++;
        if(setsA===2||setsB===2){
          const nameA=document.getElementById('nameA').value;
          const nameB=document.getElementById('nameB').value;
          const matchWinner=setsA===2?nameA:nameB;
          const matchLoser=setsA===2?nameB:nameA;
          document.getElementById('winnerMsg').textContent=`üéâ GRATULERER ${matchWinner.toUpperCase()}! DU VANT KAMPEN!\nüëè BRA JOBBA ${matchLoser.toUpperCase()}, DU GJORDE DITT BESTE.`;
          document.body.classList.add('final');
          locked=true;
          resizeScores(true); // krymp tall i finalemodus
          return;
        }
        scoreA=0;scoreB=0; currentSet++; swappedAt11=false; swapSides();
      }
      if(currentSet===3&&!swappedAt11&&(scoreA===11||scoreB===11)){
        swapSides(); swappedAt11=true;
      }
    }

    function swapSides(){
      const nameA=document.getElementById('nameA');
      const nameB=document.getElementById('nameB');
      const tmpName=nameA.value; nameA.value=nameB.value; nameB.value=tmpName;
      const tmpScore=scoreA; scoreA=scoreB; scoreB=tmpScore;
      const tmpSets=setsA; setsA=setsB; setsB=tmpSets;
      update();
    }

    function resetSet(){ if(locked) return; scoreA=0;scoreB=0;swappedAt11=false;document.getElementById('winnerMsg').textContent='';update(); }
    function resetMatch(){ scoreA=0;scoreB=0;setsA=0;setsB=0;currentSet=1;swappedAt11=false;locked=false;document.getElementById('winnerMsg').textContent='';document.body.classList.remove('final');update(); }
    function startNewMatch(){ resetMatch(); }

    function toggleFullscreen(){
      const btn=document.getElementById('fsBtn');
      if(!document.fullscreenElement){document.documentElement.requestFullscreen();if(btn)btn.textContent='‚§¢ Avslutt fullskjerm';}
      else{document.exitFullscreen();if(btn)btn.textContent='‚õ∂ Fullskjerm';}
      // fullscreenchange-listener under vil trigge resize
    }

    // Lytt p√• endringer som faktisk skal re-kalibrere fonten
    window.addEventListener('resize', ()=>{ setVH(); resizeScores(true); });
    document.addEventListener('fullscreenchange', ()=>{ resizeScores(true); });

    // iOS: hindre double-tap zoom og gj√∏r touch responsiv
    (function(){
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(e){
        const now = Date.now();
        if(now - lastTouchEnd <= 300){ e.preventDefault(); }
        lastTouchEnd = now;
      }, {passive:false});
    })();
    function bindTouch(id, fn){
      const el=document.getElementById(id);
      if(!el) return;
      el.addEventListener('touchstart', function(e){ e.preventDefault(); fn(); }, {passive:false});
    }
    bindTouch('scoreA', ()=>addPoint('A'));
    bindTouch('scoreB', ()=>addPoint('B'));
    bindTouch('newMatchBtn', ()=>startNewMatch());

    // Init
    update();
    resizeScores(true);
  </script>
</body>
</html>