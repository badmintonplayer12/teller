<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Badminton Poengteller</title>
  <style>
    :root{ --vh: 1vh; }
    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    body{margin:0;font-family:sans-serif;background:#0f172a;color:#fff;display:flex;flex-direction:column;height:100%;}
    header{background:#1f2937;padding:.5rem 1rem;display:flex;align-items:center;gap:1rem;justify-content:space-between}
    header h1{font-size:1rem;margin:0}
    .wrap{flex:1;display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:1rem}
    .side{background:#111827;border-radius:.5rem;padding:1rem;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative}
    /* Tallene skal v√¶re s√• store som mulig: opptil 90% av skjermh√∏yden, men ikke bredere enn kolonnen */
    .score{width:100%; text-align:center; font-weight:900; line-height:0.9; cursor:pointer; user-select:none; -webkit-user-select:none; -ms-user-select:none;
      font-size: min(45vw, calc(90 * var(--vh)));}
    /* Fjern bl√• markering/selection-farge p√• tallene */
    .score::selection{background:transparent}
    .minusBtn{margin-top:.75rem;font-size:1.4rem;padding:.6rem 1rem;border-radius:.5rem;border:0;background:#ef4444;color:#fff;cursor:pointer}
    footer{background:#1f2937;padding:.5rem;display:flex;gap:.5rem;justify-content:center}
    footer button{padding:.6rem 1rem;border-radius:.6rem;border:0;cursor:pointer}
    #sets{padding:.6rem 1rem;text-align:center;font-size:1.2rem}
    #winnerMsg{padding:1rem;text-align:center;font-size:2rem;color:#facc15;font-weight:bold}
    .setCounter{position:absolute;top:.5rem;right:.5rem;background:#22c55e;color:#000;font-weight:bold;border-radius:50%;width:2rem;height:2rem;display:flex;align-items:center;justify-content:center}

    /* Trykk-animasjon p√• tallene */
    @keyframes pop {
      0%   { transform: scale(1);    text-shadow:none; }
      45%  { transform: scale(1.08); text-shadow:0 0 18px rgba(250,204,21,.35); }
      100% { transform: scale(1);    text-shadow:none; }
    }
    .score.pop { animation: pop 180ms ease-out; }
  </style>
</head>
<body>
  <header>
    <h1>üè∏ Badminton Poengteller</h1>
    <button id="fsBtn" onclick="toggleFullscreen()">‚õ∂ Fullskjerm</button>
  </header>
  <div id="sets">Sett: 0‚Äì0</div>
  <div class="wrap">
    <div class="side" id="sideA">
      <div id="setCounterA" class="setCounter" style="display:none">0</div>
      <input id="nameA" value="Spiller A" style="font-size:1.2rem;text-align:center;margin-bottom:.5rem;border-radius:.3rem;border:0;padding:.2rem .5rem" />
      <div class="score" id="scoreA" onclick="addPoint('A')">0</div>
      <button class="minusBtn" onclick="removePoint('A')">‚àí1</button>
    </div>
    <div class="side" id="sideB">
      <div id="setCounterB" class="setCounter" style="display:none">0</div>
      <input id="nameB" value="Spiller B" style="font-size:1.2rem;text-align:center;margin-bottom:.5rem;border-radius:.3rem;border:0;padding:.2rem .5rem" />
      <div class="score" id="scoreB" onclick="addPoint('B')">0</div>
      <button class="minusBtn" onclick="removePoint('B')">‚àí1</button>
    </div>
  </div>
  <div id="winnerMsg"></div>
  <footer>
    <button onclick="swapSides()">Bytt side</button>
    <button onclick="resetSet()">Nullstill sett</button>
    <button onclick="resetMatch()">Nullstill kamp</button>
  </footer>
  <script>
    // --- Viewport-h√∏yde fix for mobil (adressefelt etc.) ---
    function setVH(){ document.documentElement.style.setProperty('--vh', (window.innerHeight*0.01)+'px'); }
    setVH(); window.addEventListener('resize', setVH);

    // --- Tilstand ---
    let scoreA=0, scoreB=0;
    let setsA=0, setsB=0;
    const target=21, cap=30;
    let currentSet=1;           // 1, 2, 3
    let swappedAt11=false;      // for sett 3 ‚Äì bytt kun √©n gang ved 11

    // --- UI-oppdatering ---
    function update(){
      document.getElementById('scoreA').textContent=scoreA;
      document.getElementById('scoreB').textContent=scoreB;
      document.getElementById('sets').textContent=`Sett: ${setsA}‚Äì${setsB}`;
      const counterA=document.getElementById('setCounterA');
      const counterB=document.getElementById('setCounterB');
      if(setsA>0){counterA.style.display='flex';counterA.textContent=setsA;}else counterA.style.display='none';
      if(setsB>0){counterB.style.display='flex';counterB.textContent=setsB;}else counterB.style.display='none';
    }

    // Hjelpefunksjon for trykk-animasjon
    function bump(el){
      el.classList.remove('pop');
      // reflow for √• restarte animasjonen
      void el.offsetWidth;
      el.classList.add('pop');
    }

    // --- Poengh√•ndtering ---
    function addPoint(side){
      if(side==='A') scoreA++; else scoreB++;
      checkSetEnd();
      update();
      bump(document.getElementById(side==='A' ? 'scoreA' : 'scoreB'));
    }
    function removePoint(side){
      if(side==='A' && scoreA>0) scoreA--; if(side==='B' && scoreB>0) scoreB--;
      update();
    }

    // --- Sett/kamp-logikk ---
    function checkSetEnd(){
      const lead=Math.abs(scoreA-scoreB);
      // Sett ferdig?
      if((scoreA>=target||scoreB>=target)&&(lead>=2||scoreA===cap||scoreB===cap)){
        if(scoreA>scoreB) setsA++; else setsB++;
        // Kamp ferdig? (best av 3)
        if(setsA===2||setsB===2){
          const nameA=document.getElementById('nameA').value;
          const nameB=document.getElementById('nameB').value;
          const matchWinner=setsA===2?nameA:nameB;
          const matchLoser=setsA===2?nameB:nameA;
          document.getElementById('winnerMsg').textContent=`üéâ GRATULERER ${matchWinner.toUpperCase()}! DU VANT KAMPEN! üëè BRA JOBBA ${matchLoser.toUpperCase()}, DU GJORDE DITT BESTE.`;
        }
        // Nullstill poeng for nytt sett og bytt side
        scoreA=0;scoreB=0;
        currentSet++;
        swappedAt11=false;
        swapSides();
      }
      // I tredje sett: bytt side ved 11 poeng (kun √©n gang)
      if(currentSet===3 && !swappedAt11 && (scoreA===11 || scoreB===11)){
        swapSides();
        swappedAt11=true;
      }
    }

    // --- Verkt√∏y ---
    function swapSides(){
      // bytt navn
      const nameA=document.getElementById('nameA');
      const nameB=document.getElementById('nameB');
      const tmpName=nameA.value; nameA.value=nameB.value; nameB.value=tmpName;
      // bytt score
      const tmpScore=scoreA; scoreA=scoreB; scoreB=tmpScore;
      // bytt sett-teller
      const tmpSets=setsA; setsA=setsB; setsB=tmpSets;
      update();
    }

    function resetSet(){
      scoreA=0;scoreB=0;
      swappedAt11=false;
      document.getElementById('winnerMsg').textContent='';
      update();
    }

    function resetMatch(){
      scoreA=0;scoreB=0;setsA=0;setsB=0;currentSet=1;
      swappedAt11=false;
      document.getElementById('winnerMsg').textContent='';
      update();
    }

    // --- Fullskjerm ---
    function toggleFullscreen(){
      const btn=document.getElementById('fsBtn');
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen();
        if(btn) btn.textContent='‚§¢ Avslutt fullskjerm';
      } else {
        document.exitFullscreen();
        if(btn) btn.textContent='‚õ∂ Fullskjerm';
      }
    }

    // --- Enkle konsoll-tester (kj√∏r runTests() i DevTools for √• verifisere) ---
    function runTests(){
      const log=(ok,msg)=>console[ok?'log':'error'](ok?'‚úÖ '+msg:'‚ùå '+msg);
      try{
        log(typeof toggleFullscreen==='function','toggleFullscreen er definert');
        // Bevar tilstand
        const snapshot={
          scoreA,scoreB,setsA,setsB,currentSet,swappedAt11,
          nameA: document.getElementById('nameA').value,
          nameB: document.getElementById('nameB').value,
          winnerMsg: document.getElementById('winnerMsg').textContent,
        };
        // Test: bytt ved 11 i sett 3
        scoreA=0;scoreB=0;setsA=1;setsB=1;currentSet=3;swappedAt11=false;
        document.getElementById('nameA').value='Test A';
        document.getElementById('nameB').value='Test B';
        for(let i=0;i<11;i++){ addPoint('A'); }
        log(swappedAt11===true,'Byttet side ved 11 i sett 3');
        // Test: bump-animasjon trigges
        const before = document.getElementById('scoreA').classList.contains('pop');
        addPoint('A');
        const after = document.getElementById('scoreA').classList.contains('pop');
        log(!before && after,'Trykk-animasjon p√• tall');
        // Gjenopprett tilstand
        scoreA=snapshot.scoreA;scoreB=snapshot.scoreB;setsA=snapshot.setsA;setsB=snapshot.setsB;
        currentSet=snapshot.currentSet;swappedAt11=snapshot.swappedAt11;
        document.getElementById('nameA').value=snapshot.nameA;
        document.getElementById('nameB').value=snapshot.nameB;
        document.getElementById('winnerMsg').textContent=snapshot.winnerMsg;
        update();
        log(true,'Tilstand gjenopprettet etter tester');
      }catch(e){ console.error('Tester feilet:', e); }
    }

    // Init
    update();
  </script>
</body>
</html>